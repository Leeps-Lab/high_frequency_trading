{% extends "global/Base.html" %}
{% load otree %}

{% block title %}
    Market Specific
{% endblock %}

{% block content %}
<!-- Los inputs que toman el valor de 1 es porque son la respuesta correcta -->
<body>
<br>

{% if auction == "fba" %}
<p>
    <b>1. {{ form.one_ask.label }}</b>
</p>
<div class = "first_form">
    <div><label><input name = "form1" type = "radio" value = "0"> {{ one_ask_answers.0 }}</label><br></div>
    <div><label><input name = "form1" type = "radio" value = "1"> {{ one_ask_answers.1 }}</label><br></div>    
    <div><label><input name = "form1" type = "radio" value = "0"> {{ one_ask_answers.2 }}</label><br></div>
    <div><label><input name = "form1" type = "radio" value = "0"> {{ one_ask_answers.3 }}</label><br></div>
    <div><label><input name = "form1" type = "radio" value = "0"> {{ one_ask_answers.4 }}</label></div>
</div>
<label class = "verifiers"></label>
<br>
{% else %}
<p>
    <b>1. {{ form.one_ask.label }}</b>
</p>
<div class = "first_form">
    <div><label><input name = "form1" type = "radio" value = "1"> {{ one_ask_answers.0 }}</label><br></div>
    <div><label><input name = "form1" type = "radio" value = "0"> {{ one_ask_answers.1 }}</label><br></div>    
    <div><label><input name = "form1" type = "radio" value = "0"> {{ one_ask_answers.2 }}</label><br></div>
    <div><label><input name = "form1" type = "radio" value = "0"> {{ one_ask_answers.3 }}</label><br></div>
    <div><label><input name = "form1" type = "radio" value = "0"> {{ one_ask_answers.4 }}</label></div>
</div>
<label class = "verifiers"></label>
<br>
{% endif %}

{% if auction  == "iex" %}
<p>
    <b>2. {{ form.hidden_order.label }} </b>
</p>
<div class = "first_form">
    <div><label><input name = "form2" type = "radio" value = "1"> {{ hidden_order_answers.0 }}</label><br></div>
    <div><label><input name = "form2" type = "radio" value = "0"> {{ hidden_order_answers.1 }}</label><br></div>    
    <div><label><input name = "form2" type = "radio" value = "0"> {{ hidden_order_answers.2 }}</label><br></div>
    <div><label><input name = "form2" type = "radio" value = "0"> {{ hidden_order_answers.3 }}</label><br></div>
    <div><label><input name = "form2" type = "radio" value = "0"> {{ hidden_order_answers.4 }}</label></div>
</div>
<label class = "verifiers"></label>
<br>
{% endif %}
<p><b>{{ help }}</b></p>
<br>
<button id = "next" class="otree-btn-next btn btn-primary" type = "button" >Next</button>
<button id = "submit" class="otree-btn-next btn btn-primary" hidden>Siguiente</button>

<!--fields para llenar en js-->
<input class = "fields" id = "one_ask" name = "one_ask" hidden>
<input class = "fields" id = "hidden_order" name = "hidden_order" hidden>

<!-- aca estan los fields booleanos que se llenan en js-->
<input class = "boolean" id = "one_ask_right_count" name = "one_ask_right_count" hidden>
<input class = "boolean" id = "hidden_order_right_count" name = "hidden_order_right_count" hidden>


    <script>

        // para interactuar con HTML desde JS se está usando Jquery que ya viene incorporado en Otree

        var verifiers = $(".verifiers");
        var questions = $(".first_form");
        
        var fields = $(".fields");

        var booleans = $(".boolean"); 

        var intentos = 1
        
        // respuestas correctas
        var right_answers = [
            "{{ one_ask | safe }}",
            "{{ hidden_order | safe }}",
        ]

        for (j = 0; j < questions.length ; j++)
        {
            var parent = $(questions[j]);
                var divs = parent.children();
                while (divs.length) {
                    parent.append(divs.splice(Math.floor(Math.random() * divs.length), 1)[0]);
                }
            }

        $("#next").click(function(){
            var score = 0
            // para cada pregunta
            
            for (j = 0; j < questions.length ; j++)
            {
                var inputs = $(`input[name=form${j+1}]`)

                // para cada choice
                for (i = 0; i < inputs.length ; i++)
                {
                    // si seleccionó cierta choice entonces ....
                    if ($(inputs[i]).prop("checked")) 
                    {
                        // si el valor de ese input es 1 eso quiere decir que es la respuesta correcta
                        if ($(inputs[i]).val() == "1") {
                            ++score
                            
                            $(verifiers[j]).css("color","green");
                            $(verifiers[j]).html("<b>{{ correct_answer }}</b>")
                            $(fields[j]).val(right_answers[j]) //asignando respuesta al field 
                            if (intentos == 1){
                                $(booleans[j]).val('1')
                            }else if (intentos == 2 && $(booleans[j]).val() == '0' ){
                                $(booleans[j]).val('2')
                            }

                        }else{

                            $(verifiers[j]).css("color","red");
                            if (intentos >= 2){
                                $(verifiers[j]).html("{{ correct_answer }}: " + right_answers[j])
                            }else{
                                $(verifiers[j]).html("<b>{{ wrong_answer }}</b>") //mostrar la respuesta en html
                            }
                            $(fields[j]).val(right_answers[j])
                            $(booleans[j]).val('0')

                        }
                    }
                }

            }
            ++intentos

            if (intentos == 3 ){
                var inputs = $(`input[type=radio]`)
                inputs.each(function( index ) {
                $( this ).prop( "disabled", true );
                }); 
                }        

            if (intentos == 2 && score == questions.length ){
                $("#next").prop("hidden",true); //boton next (no de submit) desaparece
                $('#next').removeAttr("type").attr("type", "submit");   
            }

            if (intentos == 4){
                $('#next').removeAttr("type").attr("type", "submit")
            }    
                   
        })
            
    </script>
</body>
{% endblock %}